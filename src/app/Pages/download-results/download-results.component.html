<div class="download-results" [ngStyle]="{'height':(items$?.length == 0)?'84vh':''}">
    <div class="container">
        <div class="text-center username">
            <strong>Usuario:&nbsp;&nbsp;{{username}}</strong>
        </div>
        <div class="row search">
            <div class="col-md-8">
                <input type="search" autocomplete="new-password" value="" placeholder="Filtrar lista..."
                id="search" name="search" [(ngModel)]="search" (keyup)="getItems($event)" 
                />
            </div>
        </div><br>
        <div class="row">
            <div class="col-md-2">
                <strong>ESTUDIOS</strong>
            </div>
            <div class="col-md-3 filter">
                <button class="btn" data-toggle="modal" data-target="#dateFilterModal">
                    <span>Filtrar por fecha</span>
                </button>
            </div>
            <div class="col-md-3 download">
                <button class="btn" (click)="DownloadAllChecked();" [disabled]="isDisabled">
                    <span>Descargar seleccionados</span>
                </button>
            </div>
            <div class="col-md-3 check-all">
                <input type="checkbox" id="check-all"
                    (click)="selectAllCheck();" name="checkAll" 
                />&nbsp;&nbsp;
                <span>{{labelCheck}} todos</span>
            </div>
        </div>

        <div class="row loading" *ngIf="loading">
            <p *ngIf="items$?.length == 0" class="info-table">
                Buscando historial ... 
            </p> 
        </div>

        <div class="result-list">
            <div class="row" *ngFor="let item of items$ | paginate: {itemsPerPage: itemsPerPage, currentPage: page}; let i = index;">
                <div class="col-md-11">
                    <div class="card">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-md-3">
                                    <p style="cursor: pointer;" (click)="showCtrl('info-'+i)">Informaci처n</p>
                                    <span (click)="showCtrl('download-'+i)" title="Descarga Individual" class="material-icons resultIcon">system_update_alt</span>
                                </div>
                                <div class="col-md-8">
                                    <p style="cursor: pointer;" (click)="showCtrl('download-'+i)">Descargar Estudios</p>
                                </div>
                                <div class="col-md-1"  (click)="downloadBlock(item, i);"  title="Descargar Estudios">
                                    <span><img src="assets/icons/svg/downloadResults/download-white-18dp.svg" alt="Download Icon"></span>
                                </div>
                            </div>
                        </div>
                        <div [id]="'info-'+i" class="card-body show-ctrl" [ngStyle]="{'border-left':(colorBarra == 'studies-s')?'#73D63B solid 17px':'#afafaf solid 17px'}">
                            <div class="row">
                                <div class="col-md-3 order">
                                    <strong>N째 de Orden</strong><br>
                                    <label>{{ item.order_consec }}</label>
                                </div>
                                <div class="col-md-2">
                                    <strong>N째 de documento</strong><br>
                                    <label>{{ item.identification }}</label>
                                </div>
                                <div class="col-md-4">
                                    <strong>Nombre del Paciente</strong><br>
                                    <label>{{ item.people_name }}</label>
                                </div>
                                <div class="col-md-3 date">
                                    <strong>Fecha de atenci처n</strong><br>
                                    <label>{{ item.date_time_ini | date:'longDate' }}</label>
                                </div>
                            </div>
                        </div>
                        <div [id]="'download-'+i" class="card-body hide-ctrl" [ngStyle]="{'border-left':(colorBarra == 'studies-s')?'#73D63B solid 17px':'#afafaf solid 17px'}">
                            <div class="row">
                                <div class="col-md-12 order">
                                    <strong>Nombre del Paciente: </strong>
                                    <label>{{item.people_name}}</label>
                                </div>
                                <div class="col-md-12"  style="border-top: gray solid 1px;" *ngFor="let study of listStudies[absoluteIndex(i)]; let x = index;">
                                    <div style="display: -webkit-box;" *ngIf="study != undefined">
                                        <div style="width: 90%; text-align: left;">
                                            {{study.name}}
                                        </div>
                                        <div style="width: 10%; text-align: end;">
                                            <div style="cursor: pointer;" *ngIf="study.Results_state == '1' && item.state_download == '1' " title="Descargar resultado" (click)="downloadResult(study.result_id, item, study.Results_state, study.name);">
                                                <span class="material-icons" style="color: blue;">download</span>
                                            </div>
                                            <div style="cursor: not-allowed;" *ngIf="study.Results_state == '0' || item.state_download == '0' " title="No se permite la descarga">
                                                <span class="material-icons" style="color: blue;">download</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-1">
                    <input type="checkbox" class="form-control" id="check-result"
                        [value]="absoluteIndex(i)" name="checkDownload" (change)="toogleDisabled()" 
                    />
                </div>
            </div>
            <pagination-controls (pageChange)="page = $event" previousLabel="Anterior" nextLabel="Siguiente"></pagination-controls>
        </div>
    </div>
</div>

<!-- [ ./ Date Filter Modal ] -->
<div class="modal" id="dateFilterModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Reporte de Resultados</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                A partir de rango de fechas
               <div class="row">
                   <div class="col-md-6">
                       <label for="dateIni">Fecha Inicial: </label>
                       <div class="date-picker">
                            <mdb-date-picker [locale]="'es'" [inline]="false" name="mydate" [options]="myDatePickerOptions" 
                                [openOnFocus]="true" inlineIcon="" [placeholder]="'Fecha Inicial:'" [(ngModel)]="dateIni" required
                            ></mdb-date-picker> 
                        </div>
                    </div>
                   <div class="col-md-6">
                       <label for="dateEnd">Fecha Final: </label>
                       <div class="date-picker">
                            <mdb-date-picker [locale]="'es'" [inline]="false" name="mydate" [options]="myDatePickerOptions" 
                                [openOnFocus]="true" inlineIcon="" [placeholder]="'Fecha Final:'" [(ngModel)]="dateEnd" required
                            ></mdb-date-picker> 
                        </div>
                    </div>
               </div>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-4">
                        <button class="btn btn-confirm" data-dismiss="modal" (click)="getOrdersByRol()">
                            <span><img width="20" src="assets/icons/svg/dynamicModal/check_circle-white-18dp.svg" alt="Confirm Icon">&nbsp;Filtrar</span>
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-denied" data-dismiss="modal" (click)="closeModalFilter()">
                            <span><img width="20" src="assets/icons/svg/dynamicModal/close-white-18dp.svg" alt="Denied Icon">&nbsp;Cancelar</span>
                        </button>
                    </div>
                    <div class="col-md-2"></div>
                </div>
                
                
            </div>
        </div>
    </div>
</div>
<!-- [ /. Date Filter Modal ] -->